<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QRKD Protocol Simulation | IBM Quantum</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c; /* Red for QRKD */
            --standard: #3498db; /* Blue for Standard QKD */
            --bg: #f4f6f7;
            --card-bg: #ffffff;
            --text: #333;
            --ibm-blue: #0f62fe; /* Official IBM Blue */
            --ibm-dark: #161616; /* IBM Black */
        }

        body {
            font-family: 'IBM Plex Sans', 'Segoe UI', sans-serif; /* IBM Style Font preference */
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 { margin: 0; color: var(--ibm-dark); font-weight: 300; letter-spacing: -1px; }
        p { margin: 5px 0; color: #7f8c8d; }

        /* --- CONTROL PANEL --- */
        .controls {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 0; /* IBM Design often uses sharp corners */
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            width: 90%;
            max-width: 1000px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 20px;
            border-left: 4px solid var(--ibm-blue);
        }

        .control-group {
            display: flex;
            flex-direction: column;
            width: 45%;
        }

        label { font-weight: 600; margin-bottom: 10px; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px; }

        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #8d8d8d;
            transition: .2s;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 18px; width: 18px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .2s;
        }
        input:checked + .slider { background-color: var(--ibm-blue); }
        input:checked + .slider:before { transform: translateX(24px); }

        /* Range Slider */
        input[type=range] { width: 100%; accent-color: var(--ibm-blue); }
        .val-display { font-size: 1.2em; font-weight: bold; color: var(--ibm-blue); }

        /* --- ANIMATION CANVAS --- */
        .simulation-container {
            width: 90%;
            max-width: 1000px;
            height: 200px;
            background: #000;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            box-sizing: border-box;
            border: 1px solid #333;
        }

        /* --- IBM LABEL (THE BADGE) --- */
        .ibm-label {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            padding: 8px 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-family: monospace;
            font-size: 0.85rem;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 8px;
            pointer-events: none;
        }
        
        .ibm-prefix {
            font-weight: 900;
            letter-spacing: 1px;
            border-right: 1px solid rgba(255,255,255,0.4);
            padding-right: 8px;
        }

        .node {
            width: 50px; height: 50px;
            background: #161616;
            border: 1px solid var(--ibm-blue);
            color: #fff;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold;
            font-size: 0.8rem;
            z-index: 2;
        }

        .fiber-optic {
            position: absolute;
            left: 65px; right: 65px;
            top: 50%;
            height: 1px;
            background: rgba(255,255,255,0.3);
            z-index: 1;
        }

        .photon {
            width: 8px; height: 8px;
            background: #3ddbd9; /* Cyan for Quantum */
            border-radius: 50%;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            box-shadow: 0 0 10px #3ddbd9;
            z-index: 2;
            transition: left 2s linear, opacity 2s linear;
        }

        /* --- DASHBOARD GRAPHS --- */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 90%;
            max-width: 1000px;
        }

        .card {
            background: var(--card-bg);
            padding: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            background: #e0e0e0;
            color: #161616;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 15px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
    </style>
</head>
<body>

    <header>
        <h1>QRKD PROTOCOL SIMULATION</h1>
        <p>Resonance-Enhanced Phase Stabilization | <span style="color:var(--ibm-blue)">IBM Quantum Engine</span></p>
    </header>

    <div class="controls">
        <div class="control-group">
            <label>Transmission Distance</label>
            <div style="display:flex; align-items:center; gap:15px; width:100%;">
                <input type="range" id="distance" min="0" max="1000" value="500">
                <span id="distanceVal" class="val-display">500 km</span>
            </div>
        </div>

        <div class="control-group" style="align-items: flex-start; padding-left: 20px; border-left: 1px solid #eee;">
            <label>Protocol Configuration</label>
            <div style="display: flex; align-items: center; gap: 15px;">
                <span style="font-size:0.9rem;">Standard QKD</span>
                <label class="switch">
                    <input type="checkbox" id="qrkdToggle">
                    <span class="slider"></span>
                </label>
                <span style="color: var(--ibm-blue); font-weight: bold; font-size:0.9rem;">QRKD Mode</span>
            </div>
        </div>
    </div>

    <div class="simulation-container">
        <div class="ibm-label">
            <span class="ibm-prefix">IBM</span> Quantum
        </div>

        <div class="node">ALICE</div>
        <div class="fiber-optic"></div>
        <div id="photonStream"></div> 
        <div class="node">BOB</div>
    </div>

    <div class="dashboard">
        <div class="card">
            <canvas id="lossChart"></canvas>
        </div>

        <div class="card">
            <canvas id="bellChart"></canvas>
            <div style="text-align: center;">
                <span id="securityStatus" class="status-badge">Initializing...</span>
            </div>
        </div>
    </div>

<script>
    // --- 1. CONFIGURATION ---
    const ctxLoss = document.getElementById('lossChart').getContext('2d');
    const ctxBell = document.getElementById('bellChart').getContext('2d');
    
    const QRKD_S_VALUE = 2.6420; 
    
    // --- 2. CHART INITIALIZATION ---
    Chart.defaults.font.family = "'IBM Plex Sans', sans-serif";
    Chart.defaults.color = '#555';

    const lossChart = new Chart(ctxLoss, {
        type: 'line',
        data: {
            labels: Array.from({length: 11}, (_, i) => i * 100),
            datasets: [
                {
                    label: 'QRKD (Resonance)',
                    borderColor: '#e74c3c',
                    backgroundColor: 'rgba(231, 76, 60, 0.05)',
                    data: [],
                    tension: 0.3,
                    borderWidth: 2,
                    pointRadius: 0
                },
                {
                    label: 'Standard QKD',
                    borderColor: '#0f62fe', // IBM Blue
                    borderDash: [5, 5],
                    data: [],
                    tension: 0.3,
                    borderWidth: 2,
                    pointRadius: 0
                }
            ]
        },
        options: {
            responsive: true,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                title: { display: true, text: 'Photon Loss Probability', align: 'start', font: {size: 14, weight:'bold'} },
                legend: { labels: { usePointStyle: true, boxWidth: 8 } }
            },
            scales: {
                y: { min: 0, max: 1.05, grid: { color: '#f0f0f0'} },
                x: { grid: { display: false } }
            }
        }
    });

    const bellChart = new Chart(ctxBell, {
        type: 'bar',
        data: {
            labels: ['Bell Parameter (S)'],
            datasets: [{
                label: 'S-Value',
                data: [0],
                backgroundColor: '#0f62fe',
                barThickness: 50
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: { display: true, text: "Security Check (Bell's Inequality)", align: 'start', font: {size: 14, weight:'bold'} },
                legend: { display: false },
                annotation: {
                    annotations: {
                        line1: {
                            type: 'line',
                            yMin: 2.0, yMax: 2.0, borderColor: '#e74c3c', borderWidth: 2, borderDash: [4,4],
                            label: { content: 'Classical Limit', enabled: true, position: 'end', backgroundColor: 'rgba(0,0,0,0.7)', font: {size:10} }
                        }
                    }
                }
            },
            scales: {
                y: { min: 0, max: 3.0, grid: { color: '#f0f0f0'} },
                x: { display: false }
            }
        }
    });

    // --- 3. SIMULATION LOGIC ---

    function updatePhysics() {
        const distance = parseInt(document.getElementById('distance').value);
        const isQRKD = document.getElementById('qrkdToggle').checked;
        
        document.getElementById('distanceVal').innerText = distance + " km";

        // Update Loss Data
        const qrkdData = [];
        const qkdData = [];
        for(let d=0; d<=1000; d+=100) {
            let lossQKD = 1 - Math.exp(-0.015 * d); 
            let lossQRKD = 1 - Math.exp(-0.004 * d);
            qkdData.push(lossQKD);
            qrkdData.push(lossQRKD);
        }
        lossChart.data.datasets[0].data = qrkdData;
        lossChart.data.datasets[1].data = qkdData;
        lossChart.update('none');

        // Update Bell's S-Value
        let sValue = 0;
        let statusText = "";
        let statusBg = "";
        let statusColor = "#fff";

        if (isQRKD) {
            sValue = QRKD_S_VALUE - (distance * 0.0005); 
            statusText = "SECURE (ENTANGLEMENT VERIFIED)";
            statusBg = "#198038"; // Green
        } else {
            if (distance > 150) {
                sValue = 0.0001; 
                statusText = "INSECURE (LINK BROKEN)";
                statusBg = "#da1e28"; // Red
            } else {
                sValue = 2.4 - (distance * 0.01);
                statusText = "SECURE (SHORT RANGE)";
                statusBg = "#198038";
            }
        }

        bellChart.data.datasets[0].data = [sValue];
        bellChart.data.datasets[0].backgroundColor = sValue > 2 ? '#0f62fe' : '#da1e28';
        bellChart.update();

        const badge = document.getElementById('securityStatus');
        badge.innerText = statusText;
        badge.style.backgroundColor = statusBg;
        badge.style.color = statusColor;
        
        updatePhotonVisuals(distance, isQRKD);
    }

    // --- 4. VISUAL ANIMATION ---
    function spawnPhoton() {
        const stream = document.getElementById('photonStream');
        const photon = document.createElement('div');
        photon.className = 'photon';
        photon.style.left = '50px'; 
        
        const distance = parseInt(document.getElementById('distance').value);
        const isQRKD = document.getElementById('qrkdToggle').checked;
        
        let decayRate = isQRKD ? 0.004 : 0.015;
        let survivalProb = Math.exp(-decayRate * distance);
        
        stream.appendChild(photon);

        setTimeout(() => {
            photon.style.left = 'calc(100% - 60px)'; 
            if (Math.random() > survivalProb) {
                photon.style.opacity = '0'; 
                photon.style.transform = 'translateY(-50%) scale(0.5)';
            }
        }, 50);

        setTimeout(() => { photon.remove(); }, 2100);
    }

    let photonInterval;
    function updatePhotonVisuals(distance, isQRKD) {
        clearInterval(photonInterval);
        photonInterval = setInterval(spawnPhoton, 400);
    }

    document.getElementById('distance').addEventListener('input', updatePhysics);
    document.getElementById('qrkdToggle').addEventListener('change', updatePhysics);

    updatePhysics();
    photonInterval = setInterval(spawnPhoton, 400);

</script>
</body>
</html>
