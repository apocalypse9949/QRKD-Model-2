<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QRKD Protocol Simulation | IBM Quantum Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c; /* Red for QRKD */
            --standard: #3498db; /* Blue for Standard QKD */
            --bg: #ecf0f1;
            --card-bg: #ffffff;
            --text: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 { margin: 0; color: var(--primary); }
        p { margin: 5px 0; color: #7f8c8d; }

        /* --- CONTROL PANEL --- */
        .controls {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 1000px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 45%;
        }

        label { font-weight: bold; margin-bottom: 10px; }

        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px; width: 26px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Range Slider */
        input[type=range] { width: 100%; }
        .val-display { font-size: 1.2em; font-weight: bold; color: var(--primary); }

        /* --- ANIMATION CANVAS --- */
        .simulation-container {
            width: 90%;
            max-width: 1000px;
            height: 180px;
            background: #000;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
            border: 4px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.9);
        }

        /* --- IBM WATERMARK STYLING --- */
        .ibm-watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-10deg);
            font-size: 5rem;
            font-weight: 900;
            color: rgba(255, 255, 255, 0.08); /* Subtle transparent white */
            pointer-events: none; /* Allows clicks to pass through */
            z-index: 0; /* Behind particles */
            white-space: nowrap;
            font-family: 'Courier New', monospace;
            letter-spacing: -2px;
            user-select: none;
        }

        .ibm-subtext {
            font-size: 1rem;
            display: block;
            text-align: right;
            opacity: 0.6;
            letter-spacing: 5px;
            font-weight: normal;
        }
        
        .node {
            width: 60px; height: 60px;
            background: #222;
            border: 2px solid #fff;
            border-radius: 5px;
            color: #fff;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold;
            z-index: 2;
            box-shadow: 0 0 15px rgba(255,255,255,0.2);
        }

        .fiber-optic {
            position: absolute;
            left: 50px; right: 50px;
            top: 50%;
            height: 2px;
            background: rgba(255,255,255,0.2);
            z-index: 1;
        }

        .photon {
            width: 12px; height: 12px;
            background: #00ffcc; /* Quantum Blue/Green */
            border-radius: 50%;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            box-shadow: 0 0 15px #00ffcc;
            z-index: 2;
            transition: left 2s linear, opacity 2s linear;
        }

        /* --- DASHBOARD GRAPHS --- */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 90%;
            max-width: 1000px;
        }

        .card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <header>
        <h1>QRKD Protocol Simulation</h1>
        <p>Resonance-Enhanced Phase Stabilization for Long-Distance QKD</p>
    </header>

    <div class="controls">
        <div class="control-group">
            <label>Transmission Distance: <span id="distanceVal" class="val-display">500</span> km</label>
            <input type="range" id="distance" min="0" max="1000" value="500">
        </div>

        <div class="control-group">
            <label>Protocol Mode</label>
            <div style="display: flex; align-items: center; gap: 10px;">
                <span>Standard QKD</span>
                <label class="switch">
                    <input type="checkbox" id="qrkdToggle">
                    <span class="slider"></span>
                </label>
                <span style="color: var(--accent); font-weight: bold;">QRKD (Resonance)</span>
            </div>
        </div>
    </div>

    <div class="simulation-container">
        <div class="ibm-watermark">
            IBM <span style="color:#3498db">Q</span>uantum
            <span class="ibm-subtext">SIMULATION ENGINE</span>
        </div>

        <div class="node">Alice</div>
        <div class="fiber-optic"></div>
        <div id="photonStream"></div> <div class="node">Bob</div>
    </div>

    <div class="dashboard">
        <div class="card">
            <canvas id="lossChart"></canvas>
        </div>

        <div class="card">
            <canvas id="bellChart"></canvas>
            <div style="text-align: center; margin-top: 10px;">
                Status: <span id="securityStatus" class="status-badge" style="background: gray;">Calculating...</span>
            </div>
        </div>
    </div>

<script>
    // --- 1. CONFIGURATION ---
    const ctxLoss = document.getElementById('lossChart').getContext('2d');
    const ctxBell = document.getElementById('bellChart').getContext('2d');
    
    // Physics Constants based on your paper
    const CLASSICAL_LIMIT = 2.0;
    const QUANTUM_BOUND = 2.828;
    const QRKD_S_VALUE = 2.6420; // Your paper's value
    
    // --- 2. CHART INITIALIZATION ---
    
    // Photon Loss Chart
    const lossChart = new Chart(ctxLoss, {
        type: 'line',
        data: {
            labels: Array.from({length: 11}, (_, i) => i * 100), // 0 to 1000 km
            datasets: [
                {
                    label: 'QRKD (Resonance-Enhanced)',
                    borderColor: '#e74c3c', // Red
                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                    data: [],
                    tension: 0.4,
                    borderWidth: 3
                },
                {
                    label: 'Standard QKD',
                    borderColor: '#3498db', // Blue
                    borderDash: [5, 5],
                    data: [],
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                title: { display: true, text: 'Photon Loss Probability vs. Distance' }
            },
            scales: {
                y: { min: 0, max: 1.05, title: {display: true, text: 'Loss Probability'} },
                x: { title: {display: true, text: 'Distance (km)'} }
            }
        }
    });

    // Bell's Inequality Bar Chart
    const bellChart = new Chart(ctxBell, {
        type: 'bar',
        data: {
            labels: ['Bell Parameter (S)'],
            datasets: [{
                label: 'S-Value',
                data: [0],
                backgroundColor: '#3498db',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: { display: true, text: "Bell's Inequality Violation (Security Check)" },
                annotation: {
                    annotations: {
                        line1: {
                            type: 'line',
                            yMin: 2.0,
                            yMax: 2.0,
                            borderColor: 'red',
                            borderWidth: 2,
                            label: { content: 'Classical Limit (2.0)', enabled: true }
                        }
                    }
                }
            },
            scales: {
                y: { min: 0, max: 3.0 }
            }
        }
    });

    // --- 3. SIMULATION LOGIC ---

    function updatePhysics() {
        const distance = parseInt(document.getElementById('distance').value);
        const isQRKD = document.getElementById('qrkdToggle').checked;
        
        document.getElementById('distanceVal').innerText = distance;

        // --- A. Update Photon Loss Data ---
        const qrkdData = [];
        const qkdData = [];
        
        for(let d=0; d<=1000; d+=100) {
            let lossQKD = 1 - Math.exp(-0.015 * d); 
            let lossQRKD = 1 - Math.exp(-0.004 * d);
            
            qkdData.push(lossQKD);
            qrkdData.push(lossQRKD);
        }
        
        lossChart.data.datasets[0].data = qrkdData;
        lossChart.data.datasets[1].data = qkdData;
        lossChart.update('none'); 

        // --- B. Update Bell's S-Value ---
        let sValue = 0;
        let statusText = "";
        let statusColor = "";

        if (isQRKD) {
            // QRKD maintains coherence
            sValue = QRKD_S_VALUE - (distance * 0.0005); 
            statusText = "SECURE (Entanglement Verified)";
            statusColor = "#27ae60"; // Green
        } else {
            // Standard QKD decoheres quickly
            if (distance > 150) {
                sValue = 0.0001; // Collapse
                statusText = "INSECURE (Decoherence)";
                statusColor = "#c0392b"; // Red
            } else {
                sValue = 2.4 - (distance * 0.01);
                statusText = "SECURE (Short Range)";
                statusColor = "#27ae60";
            }
        }

        bellChart.data.datasets[0].data = [sValue];
        bellChart.data.datasets[0].backgroundColor = sValue > 2 ? '#3498db' : '#e74c3c';
        
        bellChart.options.plugins.annotation = {
             annotations: {
                line1: {
                    type: 'line',
                    yMin: 2, yMax: 2, borderColor: 'red', borderWidth: 2
                }
            }
        };
        
        bellChart.update();

        // Update Text Badge
        const badge = document.getElementById('securityStatus');
        badge.innerText = statusText;
        badge.style.backgroundColor = statusColor;
        
        // Update visual loop
        updatePhotonVisuals(distance, isQRKD);
    }

    // --- 4. VISUAL ANIMATION ---
    function spawnPhoton() {
        const stream = document.getElementById('photonStream');
        const photon = document.createElement('div');
        photon.className = 'photon';
        photon.style.left = '60px'; // Start at Alice
        
        const distance = parseInt(document.getElementById('distance').value);
        const isQRKD = document.getElementById('qrkdToggle').checked;
        
        // Physics for visuals
        let decayRate = isQRKD ? 0.004 : 0.015;
        let survivalProb = Math.exp(-decayRate * distance);
        
        stream.appendChild(photon);

        setTimeout(() => {
            photon.style.left = 'calc(100% - 70px)'; // Move to Bob
            
            // Simulation of photon loss
            if (Math.random() > survivalProb) {
                photon.style.opacity = '0'; // Photon dies
            }
        }, 50);

        setTimeout(() => { photon.remove(); }, 2100);
    }

    let photonInterval;
    function updatePhotonVisuals(distance, isQRKD) {
        clearInterval(photonInterval);
        photonInterval = setInterval(spawnPhoton, 500);
    }

    // Listeners
    document.getElementById('distance').addEventListener('input', updatePhysics);
    document.getElementById('qrkdToggle').addEventListener('change', updatePhysics);

    // Init
    updatePhysics();
    photonInterval = setInterval(spawnPhoton, 500);

</script>
</body>
</html>
